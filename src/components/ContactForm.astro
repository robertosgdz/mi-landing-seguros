---
// Obtiene el email del destinatario desde variables de entorno
const recipientEmail = import.meta.env.RECIPIENT_EMAIL;
---
<!-- Formulario de contacto con campos requeridos y estilos Tailwind -->
<form id="contactForm" class="space-y-6 w-full max-w-350 px-4 lg:pl-0 lg:pr-8 mx-auto md:mx-0 lg:ml-0 mt-30">
  
  <!-- Campo: Nombre (obligatorio) -->
  <div>
    <label for="name" class="block text-lg font-medium text-gray-900 mb-3">
      Nombre Completo
    </label>
    <input
      type="text"
      id="name"
      name="name"
      required
      class="w-full px-4 py-3 bg-[#F5F5F7] border-0 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-gray-400 transition"
      placeholder="Tu nombre"
    />
  </div>

  <!-- Campo: Email (obligatorio, validado por navegador) -->
  <div>
    <label for="email" class="block text-lg font-medium text-gray-900 mb-3">
      Correo Electrónico
    </label>
    <input
      type="email"
      id="email"
      name="email"
      required
      class="w-full px-4 py-3 bg-[#F5F5F7] border-0 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-gray-400 transition"
      placeholder="tu@email.com"
    />
  </div>

  <!-- Campo: Teléfono (opcional) -->
  <div>
    <label for="phone" class="block text-lg font-medium text-gray-900 mb-3">
      Teléfono
    </label>
    <input
      type="tel"
      id="phone"
      name="phone"
      class="w-full px-4 py-3 bg-[#F5F5F7] border-0 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-gray-400 transition"
      placeholder="+34 600 000 000"
    />
  </div>

  <!-- Campo: Asunto (obligatorio) -->
  <div>
    <label for="subject" class="block text-lg font-medium text-gray-900 mb-3">
      Asunto
    </label>
    <input
      type="text"
      id="subject"
      name="subject"
      required
      class="w-full px-4 py-3 bg-[#F5F5F7] border-0 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-gray-400 transition"
      placeholder="¿Qué necesitas?"
    />
  </div>

  <!-- Campo: Mensaje (obligatorio, textarea de 5 filas) -->
  <div>
    <label for="message" class="block text-lg font-medium text-gray-900 mb-3">
      Mensaje
    </label>
    <textarea
      id="message"
      name="message"
      required
      rows="5"
      class="w-full px-4 py-3 bg-[#F5F5F7] border-0 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-gray-400 transition resize-none"
      placeholder="Cuéntanos más..."
    ></textarea>
  </div>

  <!-- Contenedor para mensajes de éxito/error (oculto por defecto) -->
  <div id="formStatus" class="hidden p-4 rounded-lg text-center font-semibold text-base"></div>

  <!-- Botón envío (deshabilitado durante el proceso) -->
  <button
    type="submit"
    id="submitBtn"
    class="px-8 py-3 rounded-2xl font-semibold text-base bg-black text-white hover:bg-[#0d203e] transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed active:scale-95"
  >
    Enviar Mensaje
  </button>
</form>

<script define:vars={{ recipientEmail }}>
  // Referencias a elementos del DOM
  const form = document.getElementById('contactForm');
  const formStatus = document.getElementById('formStatus');
  const submitBtn = document.getElementById('submitBtn');

  // Manejador de envío del formulario
  form.addEventListener('submit', async (e) => {
  e.preventDefault();
  submitBtn.disabled = true;

  try {
    const data = {
      name: document.getElementById('name').value.trim(),
      email: document.getElementById('email').value.trim(),
      phone: document.getElementById('phone').value.trim(),
      subject: document.getElementById('subject').value.trim(),
      message: document.getElementById('message').value.trim(),
    };

    // ✅ DEBUG DETALLADO
    console.log('name:', data.name);
    console.log('email:', data.email);
    console.log('subject:', data.subject);
    console.log('message:', data.message);
    console.log('JSON string:', JSON.stringify(data));

    const response = await fetch('/api/send-email', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
    });

    console.log('Response status:', response.status);
    const result = await response.json();
    console.log('Response body:', result);

    if (response.ok) {
      formStatus.textContent = '✅ ¡Mensaje enviado correctamente!';
      formStatus.className = 'block p-4 rounded-lg text-center font-semibold text-base bg-green-100 text-green-700';
      form.reset();
    } else {
      throw new Error(result.message || 'Error desconocido');
    }
  } catch (error) {
    console.error('Error completo:', error);
    formStatus.textContent = `❌ Error: ${error instanceof Error ? error.message : 'Error desconocido'}`;
    formStatus.className = 'block p-4 rounded-lg text-center font-semibold text-base bg-red-100 text-red-700';
  } finally {
    submitBtn.disabled = false;
  }
});


</script>
