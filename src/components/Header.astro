---
import type { lazy } from 'astro:schema';
import '../styles/header.css';
import MobileMenu from './MobileMenu.jsx';
---

<!-- HEADER FIJO -->
<header id="main-header" class="fixed top-0 left-0 w-full z-50">
  
  <!-- MENÚ DE NAVEGACIÓN -->
  <nav id="nav-container" class="w-full bg-transparent transition-all duration-1000 ease-in-out">
    <div class="w-full px-4 sm:px-6 lg:px-17.5 py-4 relative flex justify-between items-center">
      
      <!-- 1. LOGO -->
      <div class="flex items-center shrink-0 z-20">
        <img 
          id="header-logo" 
          src="/logo_aseofi_inverso.png" 
          alt="aseofi Logo" 
          class="h-20 md:h-24 lg:h-20 transition-opacity duration-1000 ease-in-out"
        />
      </div>

      <!-- 2. ENLACES (Solo Desktop Grande) -->
      <div 
        id="nav-links" 
        class="hidden lg:flex absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 space-x-10 transition-opacity duration-1000 ease-in-out opacity-100"
      >
        <a href="#how-it-works" class="nav-link text-2xl font-medium text-white hover:text-[#0d203e] transition-colors duration-1000 drop-shadow-sm">Cómo funciona</a>
        <a href="#faq" class="nav-link text-2xl font-medium text-white hover:text-[#0d203e] transition-colors duration-1000 drop-shadow-sm">Preguntas</a>
        <a href="#specialists" class="nav-link text-2xl font-medium text-white hover:text-[#0d203e] transition-colors duration-1000 drop-shadow-sm">Equipo</a>
        <a href="#contact" class="nav-link text-2xl font-medium text-white hover:text-[#0d203e] transition-colors duration-1000 drop-shadow-sm">Contáctanos</a>
      </div>

      <!-- 3. MENÚ MÓVIL Y TABLET -->
      <div class="flex items-center shrink-0 z-20 lg:hidden scale-125">
         <MobileMenu client:only="react" />
      </div>
      
    </div>
  </nav>

</header>

<script>
  // Esperar a que el DOM esté completamente cargado
  document.addEventListener('DOMContentLoaded', () => {
    const navContainer = document.getElementById('nav-container');
    const headerLogo = document.getElementById('header-logo') as HTMLImageElement | null;
    const navLinks = document.querySelectorAll('.nav-link');
    const heroSection = document.querySelector('.hero-section');
    const howitworksSection = document.getElementById('how-it-works');

    // Verificar que todos los elementos existen
    if (!navContainer || !heroSection || !howitworksSection) {
      console.warn('Elementos no encontrados para el header observer');
      return;
    }

    // ✅ OFFSET NEGATIVO: Ajusta este valor para cambiar dónde ocurre la transición
    // Valores negativos = cambia ANTES (más arriba)
    // Valores positivos = cambia DESPUÉS (más abajo)
    const TRANSITION_OFFSET = -200; // Cambia antes de que termine el hero

    // Función para aplicar estilos transparentes (Hero)
    const applyTransparentHeader = () => {
      navContainer.classList.remove('bg-white/30', 'backdrop-blur-xl', 'shadow-lg', 'border-b', 'border-white/20');
      
      if (headerLogo) {
        headerLogo.src = '/logo_aseofi_inverso.png';
      }
      
      navLinks.forEach(link => {
        link.classList.add('text-white');
        link.classList.remove('text-gray-700');
      });
      
      const hamburgerLines = document.querySelectorAll('.mobile-menu-btn svg line, .mobile-menu-btn svg path');
      hamburgerLines.forEach((line: any) => {
        line.setAttribute('stroke', '#ffffff');
      });
    };

    // Función para aplicar estilos semitransparentes (Después de Hero)
    const applySemiTransparentHeader = () => {
      navContainer.classList.add('bg-white/30', 'backdrop-blur-xl', 'shadow-lg', 'border-b', 'border-white/20');
      
      if (headerLogo) {
        headerLogo.src = '/logo_aseofi.png';
      }
      
      navLinks.forEach(link => {
        link.classList.remove('text-white');
        link.classList.add('text-gray-700');
      });
      
      const hamburgerLines = document.querySelectorAll('.mobile-menu-btn svg line, .mobile-menu-btn svg path');
      hamburgerLines.forEach((line: any) => {
        line.setAttribute('stroke', '#0d203e');
      });
    };

    // ✅ Detector en scroll con offset
    const checkHeaderStyle = () => {
      const heroBottom = heroSection.getBoundingClientRect().bottom + TRANSITION_OFFSET;
      
      // Si estamos dentro del hero (bottom > 0 significa que el hero aún es visible)
      if (heroBottom > 0) {
        applyTransparentHeader();
      } else {
        // Salimos del hero → aplicar semitransparente
        applySemiTransparentHeader();
      }
    };

    // Ejecutar al hacer scroll
    window.addEventListener('scroll', checkHeaderStyle, { passive: true });
    
    // Ejecutar al cambiar tamaño de pantalla
    window.addEventListener('resize', checkHeaderStyle);
    
    // Ejecutar inicialmente
    checkHeaderStyle();
  });
</script>
